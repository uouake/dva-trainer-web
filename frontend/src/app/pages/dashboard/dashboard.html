<div class="dash">
  <!-- Header -->
  <div class="header">
    <h1>Bonjour ðŸ‘‹</h1>
    <p class="muted">PrÃªt Ã  prÃ©parer votre certification AWS DVA-C02 ?</p>
  </div>

  <div *ngIf="loading">Chargementâ€¦</div>
  <div *ngIf="error" class="error">Erreur: {{ error }}</div>

  <!-- Stats -->
  <div class="stats" *ngIf="!loading && !error" role="list" aria-label="Statistiques de progression">
    <div class="stat card" *ngFor="let s of stats" role="listitem" [attr.aria-label]="s.label + ': ' + s.value">
      <div class="stat-value font-mono" aria-hidden="true">{{ s.value }}</div>
      <div class="stat-label muted" aria-hidden="true">{{ s.label }}</div>
    </div>
  </div>

  <div *ngIf="!loading && !error" class="reset-row">
    <button class="btn-ghost" (click)="openResetModal()" aria-label="Remettre Ã  zÃ©ro toutes les statistiques de progression">Remettre Ã  zÃ©ro les KPI</button>
  </div>

  <!-- Reset Confirmation Modal -->
  <div *ngIf="showResetModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="reset-title" aria-describedby="reset-desc">
    <div class="modal-card card">
      <h3 id="reset-title">Confirmer la rÃ©initialisation ?</h3>
      <p class="muted" id="reset-desc">Vous Ãªtes sur le point de remettre Ã  zÃ©ro toutes vos statistiques de progression. Cette action est irrÃ©versible.</p>
      <div class="modal-actions">
        <button class="btn-ghost" (click)="closeResetModal()" aria-label="Annuler la rÃ©initialisation">Annuler</button>
        <button class="btn-primary" (click)="confirmResetKpis()" aria-label="Confirmer la rÃ©initialisation des statistiques">Confirmer</button>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="actions" *ngIf="!loading && !error">
    <a
      class="action card"
      *ngFor="let a of actions"
      [routerLink]="a.to"
      [class.action-primary]="a.accent === 'primary'"
      [class.action-success]="a.accent === 'success'"
    >
      <div class="action-top">
        <div class="action-title">{{ a.title }}</div>
        <div class="chev">â€º</div>
      </div>
      <div class="action-desc muted">{{ a.description }}</div>
      <div class="action-cta">{{ a.cta }}</div>
    </a>
  </div>

  <!-- Domain progress -->
  <div class="card domain" *ngIf="!loading && !error">
    <h2>Progression par domaine</h2>

    <div *ngIf="!domainItems.length" class="muted">
      Pas assez de donnÃ©es (ou domaine non renseignÃ©). Fais une routine/exam pour alimenter les stats.
    </div>

    <div class="domain-row" *ngFor="let d of domainItems">
      <div class="domain-head">
        <div class="domain-name" [id]="'domain-' + d.label">{{ d.label }}</div>
        <div class="domain-count muted font-mono" [attr.aria-label]="d.attempts + ' tentatives, taux de rÃ©ussite: ' + (d.successRate === null ? 'non disponible' : d.successRate + '%')">
          {{ d.attempts }} tentatives â€” {{ d.successRate === null ? 'â€”' : (d.successRate + '%') }}
        </div>
      </div>
      <div class="bar" role="progressbar" [attr.aria-valuenow]="d.successRate ?? 0" aria-valuemin="0" aria-valuemax="100" [attr.aria-labelledby]="'domain-' + d.label">
        <div class="bar-fill" [style.width.%]="d.successRate ?? 0"></div>
      </div>
    </div>

    <p class="muted domain-hint" style="margin-top:12px">(Le domaine vient du champ <code>domainKey</code> de la banque de questions.)</p>
  </div>

  <!-- Weak concepts -->
  <div class="card domain" *ngIf="!loading && !error">
    <h2>Notions Ã  renforcer</h2>

    <div *ngIf="!weakConcepts.length" class="muted">Aucune erreur enregistrÃ©e pour le moment.</div>

    <ul *ngIf="weakConcepts.length" class="muted" style="margin:0; padding-left:18px">
      <li *ngFor="let w of weakConcepts">
        {{ getConceptLabel(w.conceptKey) }} â€” {{ w.wrongCount }} erreur(s)
      </li>
    </ul>

    <p class="muted domain-hint" style="margin-top:12px">(Le breakdown par domaine arrive dans une itÃ©ration suivante.)</p>
  </div>
  
</div>
