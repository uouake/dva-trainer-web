<div class="onboarding-page">
  <header class="onboarding-header">
    <h1 class="manga-title">ğŸ“š L'Histoire AWS</h1>
    <p class="manga-subtitle">Apprends AWS Ã  travers l'histoire de Yuki et son festival</p>
  </header>

  @if (loading()) {
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <p>Chargement de l'histoire...</p>
    </div>
  }

  @if (error()) {
    <div class="error-container">
      <p class="error-message">{{ error() }}</p>
      <button class="retry-btn" (click)="retry()">RÃ©essayer</button>
    </div>
  }

  @if (!loading() && !error()) {
    <!-- Progression globale -->
    @if (progress()) {
      <div class="progress-section">
        <div class="progress-info">
          <span class="progress-label">Progression Globale</span>
          <span class="progress-value">{{ progress()?.completedChapters }} / {{ progress()?.totalChapters }} chapitres</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="progress()?.progressPercentage"></div>
        </div>
      </div>
    }

    <!-- Saisons -->
    <div class="seasons-container">
      @for (season of seasons(); track season.number) {
        <div class="season-section" [class.locked]="season.isLocked">
          <!-- Season Header -->
          <div class="season-header">
            <div class="season-info">
              <h2 class="season-title">
                @if (season.isLocked) {
                  <span class="lock-icon">ğŸ”’</span>
                } @else {
                  <span class="unlock-icon">ğŸ”“</span>
                }
                {{ season.title }}
              </h2>
              <div class="season-meta">
                <span class="season-progress">
                  {{ getCompletedCount(season.chapters) }} / {{ season.chapters.length }} chapitres
                </span>
                @if (season.isLocked) {
                  <span class="locked-badge">VerrouillÃ©</span>
                }
              </div>
            </div>
            <div class="season-progress-bar">
              <div class="season-progress-fill" [style.width.%]="season.progressPercentage"></div>
            </div>
          </div>

          <!-- Chapitres de la saison -->
          <div class="chapters-list" [class.dimmed]="season.isLocked">
            @for (chapter of season.chapters; track chapter.id) {
              <div 
                class="chapter-card"
                [class.completed]="chapter.completed"
                [class.has-quiz-score]="chapter.quizScore !== null"
                [class.locked]="season.isLocked"
                (click)="!season.isLocked && navigateToChapter(chapter.id)"
                role="button"
                [attr.tabindex]="season.isLocked ? -1 : 0"
                [attr.aria-label]="season.isLocked ? 'Chapitre verrouillÃ© - ComplÃ©tez la saison prÃ©cÃ©dente' : getChapterNumberLabel(chapter) + ': ' + chapter.title"
                (keydown.enter)="!season.isLocked && navigateToChapter(chapter.id)"
              >
                <div class="chapter-icon">{{ getChapterIcon(chapter.type) }}</div>
                <div class="chapter-content">
                  <div class="chapter-number">{{ getChapterNumberLabel(chapter) }}</div>
                  <h3 class="chapter-title">{{ chapter.title }}</h3>
                </div>
                <div class="chapter-status">
                  @if (chapter.quizScore !== null) {
                    <span class="quiz-score">{{ chapter.quizScore }}%</span>
                  }
                  @if (chapter.completed) {
                    <span class="completed-badge">âœ“</span>
                  } @else {
                    @if (season.isLocked) {
                      <span class="locked-indicator">ğŸ”’</span>
                    } @else {
                      <span class="pending-badge">â†’</span>
                    }
                  }
                </div>
              </div>
            }
          </div>

          @if (season.isLocked) {
            <div class="locked-overlay">
              <div class="locked-message">
                <span class="locked-icon">ğŸ”</span>
                <p>ComplÃ©tez tous les chapitres de la Saison {{ season.number - 1 }} pour dÃ©bloquer</p>
              </div>
            </div>
          }
        </div>
      }
    </div>

    <!-- Bouton architecture -->
    <div class="architecture-section">
      <button class="architecture-btn" (click)="navigateToArchitecture()">
        <span class="btn-icon">ğŸ—ï¸</span>
        <span class="btn-text">Voir l'architecture complÃ¨te</span>
      </button>
    </div>
  }
</div>
